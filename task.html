<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<script>
		const params = new URLSearchParams(window.location.search);
		const tasks = {
		  "unlock_manifolds": 0,
		  "transfer_data": 1
		};
		const rooms = {
		  "reactor": 0,
		  "o2": 1,
		  "storage": 2,
		  "hallway": 3,
		  "electrical": 4,
		  "admin": 5,
		  "cafeteria": 6,
		  "shields": 7
		};

		function strhash(str) {
		  var h = 0;
		  
		  for (var i = 0; i < str.length; i++) {
            h = Math.imul(31, h) + str.charCodeAt(i);
          }
		  
		  return h;
		}
		
		function random(mask, seedinit, mod1, mod2, mod3) {
          var seed = Math.imul(375462423, seedinit) + 672456235;
          
          seed += mod1;
          seed = Math.imul(375462423, seed) + 672456235;
		  seed += mod2;
          seed = Math.imul(375462423, seed) + 672456235;
		  seed += mod3;
          seed = Math.imul(375462423, seed) + 672456235;
          
          return seed & mask;
	    }
		
		function taskkey(str, room) {
		  var ima = new Date();
		  var shiftedTimeKey = random(0x3FF, strhash(str), ima.getUTCHours(), ima.getUTCDate(), Math.floor(ima.getUTCMinutes() / 2)) << 3;
		  return ((shiftedTimeKey | rooms[room]) << 6) | (0x7F & tasks[str]);
		}
		
		window.onload = function() {
		  var task = document.getElementById("task");
		  task.innerHTML = "<h1>" + taskkey(params.get("task")).toString() + "</h1>";
		  
		  let canvasElement = document.querySelector("canvas");

          canvasElement.addEventListener("mousedown", function(e) 
          {
            let clickPos = getMousePos(canvasElement, e);
		    console.log(clickPos);
          });
		}
		
		function getMousePos(canvas, evnt) {
		  let rect = canvas.getBoundingClientRect();
		  let x = evnt.clientX - rect.left;
		  let y = evnt.clientY - rect.top;
		  return [x, y];
		}
		</script>
	</head>
	<body>
		<div id = "task"></div>
		<canvas width="300" height = "300" style="border:1px solid #000000;"></canvas>
	</body>
</html>